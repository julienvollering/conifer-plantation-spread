---
title: "Manuscript tables"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
```

# Species correlations in establishment

```{r}
results <- readRDS(here('output', 'results.rds'))
fit <- map2(results$model.preds, names(results$model.preds),  
           ~ filter(.data = .x, is.na(locality)) %>% 
             select(nin, !!.y := fit))
fitdf <- reduce(fit, full_join, by = "nin") %>% 
  select(-nin)
colnames(fitdf) <- c("Picea sitchensis / lutzii", "Picea abies", "Larix", "Pinus contorta")
table <- cor(fitdf, use= "pairwise.complete.obs", method = "spearman") %>% 
  round(digits = 2)
write.csv(table, here('ms', 'tables', 'spearman-corr.csv'), row.names = TRUE)
```


# Model summaries

```{r}
results <- readRDS(here('output', 'results.rds'))

Psmod <- results$models$`P.sitchensis-lutzii`
Nre <- Psmod$modelInfo$reStruc$condReStruc$`1 | locality`$blockReps
Ps.tidy <- broom.mixed::tidy(Psmod)
Ps <- Ps.tidy %>% 
  arrange(component) %>% 
  mutate(component = if_else(component == 'cond', 
                             'Conditional Model', 
                             'Zero-inflation model')) %>% 
  mutate(ci.l = estimate - 1.96*std.error, ci.u = estimate + 1.96*std.error) %>% 
  mutate_if(is.double, ~ round(., digits = 2)) %>% 
  mutate(`95% CI` = if_else(is.na(std.error), NA_character_, paste0(ci.l, ', ', ci.u)),
         term = if_else(term == 'seeds.WALD:age', 'seeds.WALD * age', term)) %>% 
  mutate(`SD (Intercept)` = if_else(effect == 'fixed', NA_real_, estimate),
         estimate = if_else(effect == 'fixed', estimate, NA_real_),
         N = if_else(effect == 'fixed', NA_real_, Nre),
         term = if_else(effect == 'fixed', term, 'locality')) %>% 
  select(`Mixture component` = component, Term = term, Estimate = estimate, 
         `95% CI`, `SD (Intercept)`, N)
write_csv(Ps, here('ms', 'tables', 'Ps-modelsummary.csv'))

Pamod <- results$models$P.abies
Nre <- Pamod$modelInfo$reStruc$condReStruc$`1 | locality`$blockReps
Pa.tidy <- broom.mixed::tidy(Pamod)
Pa <- Pa.tidy %>% 
  arrange(component) %>% 
  mutate(component = if_else(component == 'cond', 
                             'Conditional Model', 
                             'Zero-inflation model')) %>% 
  mutate(ci.l = estimate - 1.96*std.error, ci.u = estimate + 1.96*std.error) %>% 
  mutate_if(is.double, ~ round(., digits = 2)) %>% 
  mutate(`95% CI` = if_else(is.na(std.error), NA_character_, paste0(ci.l, ', ', ci.u)),
         term = if_else(term == 'seeds.WALD:age', 'seeds.WALD * age', term)) %>% 
  mutate(`SD (Intercept)` = if_else(effect == 'fixed', NA_real_, estimate),
         estimate = if_else(effect == 'fixed', estimate, NA_real_),
         N = if_else(effect == 'fixed', NA_real_, Nre),
         term = if_else(effect == 'fixed', term, 'locality')) %>% 
  select(`Mixture component` = component, Term = term, Estimate = estimate, 
         `95% CI`, `SD (Intercept)`, N)
write_csv(Pa, here('ms', 'tables', 'Pa-modelsummary.csv'))

Lmod <- results$models$Larix
Nre <- Lmod$modelInfo$reStruc$condReStruc$`1 | locality`$blockReps
L.tidy <- broom.mixed::tidy(Lmod)
L <- L.tidy %>% 
  arrange(component) %>% 
  mutate(component = if_else(component == 'cond', 
                             'Conditional Model', 
                             'Zero-inflation model')) %>% 
  mutate(ci.l = estimate - 1.96*std.error, ci.u = estimate + 1.96*std.error) %>% 
  mutate_if(is.double, ~ round(., digits = 2)) %>% 
  mutate(`95% CI` = if_else(is.na(std.error), NA_character_, paste0(ci.l, ', ', ci.u)),
         term = if_else(term == 'seeds.WALD:age', 'seeds.WALD * age', term)) %>% 
  mutate(`SD (Intercept)` = if_else(effect == 'fixed', NA_real_, estimate),
         estimate = if_else(effect == 'fixed', estimate, NA_real_),
         N = if_else(effect == 'fixed', NA_real_, Nre),
         term = if_else(effect == 'fixed', term, 'locality')) %>% 
  select(`Mixture component` = component, Term = term, Estimate = estimate, 
         `95% CI`, `SD (Intercept)`, N)
write_csv(L, here('ms', 'tables', 'L-modelsummary.csv'))

Pcmod <- results$models$P.contorta
Nre <- Pcmod$modelInfo$reStruc$condReStruc$`1 | locality`$blockReps
Pc.tidy <- broom.mixed::tidy(Pcmod)
Pc <- Pc.tidy %>% 
  arrange(component) %>% 
  mutate(component = if_else(component == 'cond', 
                             'Conditional Model', 
                             'Zero-inflation model')) %>% 
  mutate(ci.l = estimate - 1.96*std.error, ci.u = estimate + 1.96*std.error) %>% 
  mutate_if(is.double, ~ round(., digits = 2)) %>% 
  mutate(`95% CI` = if_else(is.na(std.error), NA_character_, paste0(ci.l, ', ', ci.u)),
         term = if_else(term == 'seeds.WALD:age', 'seeds.WALD * age', term)) %>% 
  mutate(`SD (Intercept)` = if_else(effect == 'fixed', NA_real_, estimate),
         estimate = if_else(effect == 'fixed', estimate, NA_real_),
         N = if_else(effect == 'fixed', NA_real_, Nre),
         term = if_else(effect == 'fixed', term, 'locality')) %>% 
  select(`Mixture component` = component, Term = term, Estimate = estimate, 
         `95% CI`, `SD (Intercept)`, N)
write_csv(Pc, here('ms', 'tables', 'Pc-modelsummary.csv'))
```

# sessionInfo 

```{r sessionInfo}
sessionInfo()
```