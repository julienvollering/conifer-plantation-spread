---
title: "Climate data"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(sf)
library(rnaturalearth)
```

# Locality map

```{r}
ne_download(scale = 50, type = 'populated_places', category = 'cultural', 
            destdir = here("data", "raw", "cartographic"), load = FALSE)
ne_download(scale = 10, type = 'minor_islands', category = 'physical', 
            destdir = here("data", "raw", "cartographic"), load = FALSE)
```


```{r}
cities <- ne_load(scale = 50, type = 'populated_places', category = 'cultural', 
                  destdir = here("data", "raw", "cartographic"), returnclass = 'sf')
norcities <- filter(cities, NAME %in% c("Oslo", "Trondheim", "Bergen"))
norislands <- ne_load(scale = 10, type = 'minor_islands', category = 'physical', 
                destdir = here("data", "raw", "cartographic"), returnclass = 'sf') %>% 
  st_crop(xmin = 4, xmax = 32, ymin = 58, ymax = 72) %>% 
  st_transform(crs = 25833) # ETRS89 / UTM zone 33N

nor50 <- ne_countries(scale = 50, country = "Norway", returnclass = "sf") %>% 
  st_transform(crs = 25833)
nor10 <- ne_countries(scale = 10, country = "Norway", returnclass = "sf") %>% 
  st_transform(crs = 25833)

locs <- read_csv(here("data", "localities.csv"), col_types = cols()) %>% 
  st_as_sf(coords=c("utm33.easting", "utm33.northing"), crs = 25833)
locs <- mutate(locs, species.latin = as_factor(species.latin))
st_bbox(locs)

g1 <- ggplot() +
  geom_sf(data = nor50, fill = "antiquewhite") + 
  geom_sf(data = st_jitter(locs, amount=5e3), mapping = aes(color = species.latin), 
          show.legend = "point", size = 3, alpha = 0.5) + 
  geom_sf(data = norcities) +
  geom_sf_label(data = norcities, aes(label = NAME), nudge_y = 4e4, 
                size = 3) +
  scale_color_brewer(palette="Dark2") +
  coord_sf(xlim = c(-60e3,670e3), ylim = c(6.5e6,7.8e6)) +
  theme_minimal() +
  theme(legend.position = c(0.3,0.9), legend.title = element_blank(), 
        legend.text = element_text(face = "italic"))

filter(locs, county %in% c("Hordaland", "Rogaland")) %>% 
  st_bbox()
g2 <- ggplot() +
  geom_sf(data = nor10, fill = "antiquewhite") + 
  geom_sf(data = norislands, fill = "antiquewhite") + 
  geom_sf(data = locs, mapping = aes(color = species.latin), 
          show.legend = FALSE, size = 3, alpha = 0.5) + 
  scale_color_brewer(palette="Dark2") +
  coord_sf(xlim = c(-60e3,10e3), ylim = c(6.5e6,6.66e6), datum = NA) +
  theme_minimal()

st_bbox(nor50)
g1 + annotation_custom(ggplotGrob(g2), xmin = 1e5, xmax = 1e6, 
                       ymin = 6.5e6, ymax = 7e6)

```

```{r sessionInfo}
sessionInfo()
```